<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Formulario — Catálogo</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; max-width: 880px; margin: 24px auto; padding: 0 16px; }
    fieldset { border: 1px solid #ddd; border-radius: 8px; padding: 16px; margin-bottom: 18px; }
    legend { font-weight: 600; }
    .grid { display: grid; gap: 12px; }
    .g2 { grid-template-columns: repeat(2, minmax(0,1fr)); }
    .g3 { grid-template-columns: repeat(3, minmax(0,1fr)); }
    label { display:block; margin-bottom:4px; }
    input, select, textarea { width: 100%; padding: 8px; border: 1px solid #bbb; border-radius: 6px; }
    .muted { color:#666; font-size:.9rem; }
    .actions { display:flex; gap:12px; }
    button { padding: 8px 12px; border: 1px solid #999; border-radius: 6px; background: #f5f5f5; cursor: pointer; }
    button.primary { background: #6366f1; color:white; border-color:#6366f1; }
    code { background:#f1f5f9; padding:2px 4px; border-radius:4px; }
    #out { white-space: pre-wrap; background:#0b1020; color:#d9ffe7; padding:12px; border-radius:8px; font-size:.9rem; }
  </style>
</head>
<body>
  <a href="./../../index.html">[Principal]</a>
  <h1>Formulario: Catálogo</h1>
  <p class="muted">ADMIN: define servicios y refacciones. El stock real se maneja en <strong>Inventario</strong>.</p>

  <form id="frmCatalogo" onsubmit="handleSubmit(event)">
    <fieldset>
      <legend>Identificador (SKU)</legend>
      <div class="grid g3">
        <div>
          <label>Tipo</label>
          <select id="tipo" name="tipo" required>
            <option value="">—</option>
            <option value="SRV">Servicio</option>
            <option value="REF">Refacción</option>
          </select>
        </div>
        <div>
          <label>Categoria/Código corto (ej: MANT, SOFT, SSD, HDD, RAM)</label>
          <input id="codigo_corto" maxlength="8" oninput="this.value=this.value.toUpperCase()" required />
        </div>
        <div>
          <label>Consecutivo</label>
          <input id="consecutivo" type="number" min="1" value="1" required />
        </div>
      </div>
      <div class="grid">
        <div>
          <label>Id_item (auto)</label>
          <input id="Id_item" name="Id_item" readonly placeholder="SRV-MANT-0001" />
        </div>
      </div>
      <p class="muted">Formato: <code>SRV|REF</code>-<code>CÓDIGO</code>-<code>0001</code></p>
    </fieldset>

    <fieldset>
      <legend>Datos del ítem</legend>
      <div class="grid g2">
        <div><label>Nombre del ítem</label><input name="nombre_item" required /></div>
        <div><label>Precio por unidad (MXN)</label><input name="precio_item_unidad" type="number" step="0.01" min="0" required /></div>
      </div>
      <div class="grid">
        <div><label>Descripción</label><textarea name="descripcion" rows="4"></textarea></div>
      </div>
      <div class="grid g2">
        <div>
          <label>¿Requiere número de serie? (solo refacciones)</label>
          <select name="requiere_serial" id="requiere_serial">
            <option value="no">no</option>
            <option value="si">sí</option>
          </select>
        </div>
        <div>
          <label>Número de serie (opcional)</label>
          <input name="no_serial_refaccion" id="no_serial_refaccion" placeholder="Si aplica" />
        </div>
      </div>
      <p class="muted">La <strong>existencia/cantidad</strong> se administra en el módulo de Inventario.</p>
    </fieldset>

    <div class="actions">
      <button class="primary" type="submit">Guardar (mock)</button>
      <button type="reset">Limpiar</button>
    </div>
  </form>

  <h3>Salida (mock)</h3>
  <pre id="out"></pre>

  <script>
    const tipo = document.getElementById('tipo');
    const cod  = document.getElementById('codigo_corto');
    const cons = document.getElementById('consecutivo');
    const sku  = document.getElementById('Id_item');
    const reqSerial = document.getElementById('requiere_serial');
    const serialInp = document.getElementById('no_serial_refaccion');

    function pad(n){ return String(Math.max(1, Number(n)||1)).padStart(4,'0'); }
    function updateSKU(){
      if(!tipo.value || !cod.value) { sku.value=''; return; }
      sku.value = `${tipo.value}-${cod.value.toUpperCase()}-${pad(cons.value)}`;
    }
    tipo.addEventListener('change', updateSKU);
    cod.addEventListener('input', updateSKU);
    cons.addEventListener('input', updateSKU);
    updateSKU();

    reqSerial.addEventListener('change', () => {
      const isRef = (tipo.value === 'REF');
      serialInp.disabled = !(isRef && reqSerial.value === 'si');
      if (serialInp.disabled) serialInp.value = '';
    });
    tipo.addEventListener('change', () => {
      // si es servicio, no permite serial
      const isRef = (tipo.value === 'REF');
      if(!isRef){ reqSerial.value = 'no'; serialInp.disabled = true; serialInp.value=''; }
    });

    function handleSubmit(e){
      e.preventDefault();
      if(!sku.value){ alert('Genera el Id_item (SKU)'); return; }
      const data = Object.fromEntries(new FormData(e.target).entries());
      document.getElementById('out').textContent = JSON.stringify(data, null, 2);
    }
  </script>
</body>
</html>
